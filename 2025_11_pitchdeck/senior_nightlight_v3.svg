<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 950 780">
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#555"/>
    </marker>
  </defs>
  
  <!-- Background -->
  <rect width="950" height="780" fill="#f8f9fa"/>
  
  <!-- Title -->
  <text x="475" y="35" font-family="Arial, sans-serif" font-size="20" font-weight="bold" text-anchor="middle" fill="#333">Senior Nightlight with Fall Detection v3 - Block Diagram</text>
  
  <!-- Power Supply Section -->
  <rect x="30" y="70" width="180" height="140" rx="8" fill="#fff3e0" stroke="#ff9800" stroke-width="2"/>
  <text x="120" y="95" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#e65100">POWER SUPPLY</text>
  
  <rect x="50" y="110" width="140" height="35" rx="4" fill="#fff" stroke="#ff9800" stroke-width="1"/>
  <text x="120" y="132" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#333">AC-DC (120V â†’ 5V)</text>
  
  <rect x="50" y="155" width="140" height="35" rx="4" fill="#fff" stroke="#ff9800" stroke-width="1"/>
  <text x="120" y="177" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#333">LDO 3.3V (AMS1117)</text>
  
  <!-- ESP32 Main Controller -->
  <rect x="370" y="250" width="210" height="200" rx="10" fill="#e3f2fd" stroke="#1976d2" stroke-width="3"/>
  <text x="475" y="280" font-family="Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle" fill="#0d47a1">ESP32-C3</text>
  <text x="475" y="300" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#555">Main Controller</text>
  
  <text x="390" y="330" font-family="Arial, sans-serif" font-size="10" fill="#333">â€¢ UART0 - mmWave</text>
  <text x="390" y="348" font-family="Arial, sans-serif" font-size="10" fill="#333">â€¢ I2C - Thermal + Light</text>
  <text x="390" y="366" font-family="Arial, sans-serif" font-size="10" fill="#333">â€¢ I2S - Mic (impact detect)</text>
  <text x="390" y="384" font-family="Arial, sans-serif" font-size="10" fill="#333">â€¢ SPI - Voice chip + LED</text>
  <text x="390" y="402" font-family="Arial, sans-serif" font-size="10" fill="#333">â€¢ GPIO - Voice INT, Buzzer</text>
  <text x="390" y="420" font-family="Arial, sans-serif" font-size="10" fill="#333">â€¢ WiFi - Alerts</text>
  
  <!-- Sensors Section -->
  <rect x="30" y="250" width="270" height="240" rx="8" fill="#e8f5e9" stroke="#4caf50" stroke-width="2"/>
  <text x="165" y="275" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#2e7d32">SENSORS</text>
  
  <!-- mmWave Sensor -->
  <rect x="50" y="295" width="230" height="55" rx="6" fill="#fff" stroke="#4caf50" stroke-width="1.5"/>
  <text x="165" y="315" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="#333">C1001 mmWave (60GHz)</text>
  <text x="165" y="332" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#666">Presence, Motion, Basic Fall</text>
  <text x="165" y="345" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#888">UART 115200 | 3.3V | 11m range</text>
  
  <!-- Thermal Array -->
  <rect x="50" y="360" width="230" height="55" rx="6" fill="#fff" stroke="#4caf50" stroke-width="1.5"/>
  <text x="165" y="380" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="#333">AMG8833 Thermal Array</text>
  <text x="165" y="397" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#666">8Ã—8 IR pixels, Posture Detection</text>
  <text x="165" y="410" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#888">I2C 0x69 | 3.3V | 7m range</text>
  
  <!-- Ambient Light Sensor -->
  <rect x="50" y="425" width="230" height="45" rx="6" fill="#fff" stroke="#4caf50" stroke-width="1.5"/>
  <text x="165" y="445" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="#333">VEML7700 Light Sensor</text>
  <text x="165" y="462" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#666">I2C | Auto night mode trigger</text>
  
  <!-- Voice Recognition Section -->
  <rect x="30" y="510" width="270" height="170" rx="8" fill="#e1f5fe" stroke="#0288d1" stroke-width="2"/>
  <text x="165" y="535" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#01579b">VOICE RECOGNITION</text>
  
  <!-- Voice Chip -->
  <rect x="50" y="555" width="230" height="70" rx="6" fill="#fff" stroke="#0288d1" stroke-width="1.5"/>
  <text x="165" y="575" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="#333">Syntiant NDP120</text>
  <text x="165" y="592" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#666">Always-on Neural Keyword Spotting</text>
  <text x="165" y="605" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#888">~140ÂµW | SPI/I2C | Custom wake words</text>
  <text x="165" y="618" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#2e7d32">"Help" "Emergency" "Call someone"</text>
  
  <!-- Dedicated Mic for Voice -->
  <rect x="50" y="635" width="230" height="35" rx="6" fill="#fff" stroke="#0288d1" stroke-width="1.5"/>
  <text x="165" y="658" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#333">PDM Mic (SPH0645) â†’ NDP120</text>
  
  <!-- Audio Section -->
  <rect x="370" y="480" width="210" height="80" rx="8" fill="#f3e5f5" stroke="#9c27b0" stroke-width="2"/>
  <text x="475" y="505" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#6a1b9a">IMPACT AUDIO</text>
  
  <rect x="390" y="520" width="170" height="30" rx="4" fill="#fff" stroke="#9c27b0" stroke-width="1"/>
  <text x="475" y="540" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#333">INMP441 â†’ ESP32 I2S</text>
  
  <!-- Outputs Section - EXPANDED -->
  <rect x="660" y="250" width="260" height="260" rx="8" fill="#fce4ec" stroke="#e91e63" stroke-width="2"/>
  <text x="790" y="275" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#c2185b">OUTPUTS</text>
  
  <!-- RGB LED Array - UPDATED -->
  <rect x="680" y="295" width="220" height="75" rx="6" fill="#fff" stroke="#e91e63" stroke-width="1.5"/>
  <text x="790" y="315" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="#333">SK6812 RGBW LED Strip</text>
  <text x="790" y="332" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#666">Addressable | 8-12 LEDs | ~2W</text>
  <!-- Color dots -->
  <circle cx="720" cy="352" r="8" fill="#ff4444"/>
  <circle cx="745" cy="352" r="8" fill="#44ff44"/>
  <circle cx="770" cy="352" r="8" fill="#4444ff"/>
  <circle cx="795" cy="352" r="8" fill="#ffcc00"/>
  <circle cx="820" cy="352" r="8" fill="#ffffff" stroke="#ccc" stroke-width="1"/>
  <text x="850" y="356" font-family="Arial, sans-serif" font-size="8" fill="#666">RGBW</text>
  
  <!-- LED Mode Callout -->
  <rect x="680" y="380" width="220" height="60" rx="4" fill="#ffebee" stroke="#ef9a9a" stroke-width="1"/>
  <text x="790" y="398" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="#c62828">LED MODES:</text>
  <text x="700" y="413" font-family="Arial, sans-serif" font-size="9" fill="#333">ðŸ”´ Night: Dim red (preserves vision)</text>
  <text x="700" y="426" font-family="Arial, sans-serif" font-size="9" fill="#333">âšª Motion: Warm white (2700K)</text>
  <text x="700" y="439" font-family="Arial, sans-serif" font-size="9" fill="#333">ðŸ”´ Alert: Pulsing red (fall detected)</text>
  
  <!-- Piezo Buzzer -->
  <rect x="680" y="450" width="220" height="40" rx="6" fill="#fff" stroke="#e91e63" stroke-width="1.5"/>
  <text x="790" y="475" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="#333">Piezo Buzzer (local alert)</text>
  
  <!-- Communication Section -->
  <rect x="660" y="530" width="260" height="100" rx="8" fill="#ede7f6" stroke="#673ab7" stroke-width="2"/>
  <text x="790" y="555" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#4527a0">COMMUNICATION</text>
  
  <rect x="680" y="570" width="220" height="45" rx="6" fill="#fff" stroke="#673ab7" stroke-width="1.5"/>
  <text x="790" y="590" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="#333">WiFi â†’ Hub / Cloud</text>
  <text x="790" y="607" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#666">MQTT / HTTP | Push Notifications</text>
  
  <!-- Connection Lines -->
  <!-- Power to ESP32 -->
  <line x1="210" y1="172" x2="370" y2="290" stroke="#ff9800" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="280" y="215" font-family="Arial, sans-serif" font-size="9" fill="#ff9800">3.3V + 5V</text>
  
  <!-- Sensors to ESP32 -->
  <line x1="280" y1="322" x2="370" y2="330" stroke="#4caf50" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="315" y="318" font-family="Arial, sans-serif" font-size="9" fill="#4caf50">UART</text>
  
  <line x1="280" y1="387" x2="370" y2="355" stroke="#4caf50" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="315" y="378" font-family="Arial, sans-serif" font-size="9" fill="#4caf50">I2C</text>
  
  <line x1="280" y1="447" x2="370" y2="375" stroke="#4caf50" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Voice chip to ESP32 -->
  <line x1="280" y1="590" x2="370" y2="420" stroke="#0288d1" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="310" y="520" font-family="Arial, sans-serif" font-size="9" fill="#0288d1">INT + SPI</text>
  
  <!-- Impact audio to ESP32 -->
  <line x1="475" y1="480" x2="475" y2="450" stroke="#9c27b0" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="490" y="468" font-family="Arial, sans-serif" font-size="9" fill="#9c27b0">I2S</text>
  
  <!-- ESP32 to Outputs -->
  <line x1="580" y1="320" x2="680" y2="335" stroke="#e91e63" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="620" y="318" font-family="Arial, sans-serif" font-size="9" fill="#e91e63">DATA (1-wire)</text>
  
  <line x1="580" y1="360" x2="680" y2="470" stroke="#e91e63" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="620" y="400" font-family="Arial, sans-serif" font-size="9" fill="#e91e63">GPIO</text>
  
  <!-- ESP32 to Comms -->
  <line x1="580" y1="420" x2="660" y2="580" stroke="#673ab7" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="610" y="500" font-family="Arial, sans-serif" font-size="9" fill="#673ab7">WiFi</text>
  
  <!-- Fusion Logic Box -->
  <rect x="320" y="600" width="320" height="150" rx="8" fill="#fff8e1" stroke="#ffc107" stroke-width="2"/>
  <text x="480" y="625" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#f57f17">SENSOR FUSION LOGIC</text>
  
  <text x="340" y="655" font-family="Arial, sans-serif" font-size="10" fill="#333">1. mmWave: sudden stillness detected?</text>
  <text x="340" y="673" font-family="Arial, sans-serif" font-size="10" fill="#333">2. Impact audio: thud/crash heard?</text>
  <text x="340" y="691" font-family="Arial, sans-serif" font-size="10" fill="#333">3. Thermal: heat blob at floor level?</text>
  <text x="340" y="709" font-family="Arial, sans-serif" font-size="10" fill="#d32f2f" font-weight="bold">4. Voice: "Help" / "Emergency" detected?</text>
  <text x="340" y="735" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#1b5e20">â†’ Voice trigger = IMMEDIATE ALERT</text>
  <text x="340" y="748" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#1b5e20">â†’ 2 of 3 sensors = FALL ALERT</text>
  
  <!-- Arrow from ESP32 to Fusion -->
  <line x1="475" y1="450" x2="475" y2="480" stroke="#ffc107" stroke-width="2" stroke-dasharray="5,3"/>
  <line x1="480" y1="560" x2="480" y2="600" stroke="#ffc107" stroke-width="2" stroke-dasharray="5,3"/>
  
  <!-- Red Light Benefits Callout -->
  <rect x="700" y="655" width="220" height="95" rx="6" fill="#ffebee" stroke="#d32f2f" stroke-width="2"/>
  <text x="810" y="678" font-family="Arial, sans-serif" font-size="11" font-weight="bold" text-anchor="middle" fill="#b71c1c">Why Red at Night?</text>
  <text x="720" y="698" font-family="Arial, sans-serif" font-size="9" fill="#333">â€¢ Preserves night vision</text>
  <text x="720" y="713" font-family="Arial, sans-serif" font-size="9" fill="#333">â€¢ Doesn't suppress melatonin</text>
  <text x="720" y="728" font-family="Arial, sans-serif" font-size="9" fill="#333">â€¢ Less startling if woken</text>
  <text x="720" y="743" font-family="Arial, sans-serif" font-size="9" fill="#333">â€¢ Reduces fall risk (adapted eyes)</text>
  
  <!-- Notes -->
  <text x="30" y="770" font-family="Arial, sans-serif" font-size="10" fill="#666">Wall-plug form factor | ~5W total | SK6812 RGBW for full color control | Red night mode preserves circadian rhythm</text>
  
</svg>
